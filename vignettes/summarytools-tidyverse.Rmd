---
title: "summarytools in the Age of tidyverse"
author: "Dominic Comtois"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette: 
    css: 
    - !expr system.file("rmarkdown/templates/html_vignette/resources/vignette.css", package = "rmarkdown")
vignette: >
  %\VignetteIndexEntry{Introduction to summarytools}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{magrittr}
  %\VignetteDepends{forcats}
  %\VignetteDepends{dplyr}
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(comment = NA, prompt = FALSE, cache = FALSE, results = 'asis')
library(summarytools)
library(dplyr)
library(forcats)
library(magrittr)
st_options(plain.ascii = FALSE,
           style = "rmarkdown",
           footnote = NA,
           subtitle.emphasis = FALSE)
```

```{r, echo=FALSE}
st_css()
```

# Introduction

I started writing **summarytools** several years ago (the first CRAN 
release dates back to 2014), way before the **tidyverse** came about,
profoundly impacting the way people use R, write their code and
organize their thoughts while doing analysis. My focus in the last
months has been making **summarytools** fit more naturally in
this new framework.

I've considered making "twin copies" of the four core functions
so that one would work best with the traditionnal/base R and the
other with the **tidyverse** functions. I'Ve opted against it for
various reasons, but mainly because I found ways to modify the
existing functions in such a way that would make them compatible
enough with the **tidyverse**, all the while maintaining full backward
compatibility. 

This document exposes the various ways (both "traditional" and 
"tidyverse-oriented") **summarytools**' functions can be used, as
well as present some new features of the package. A review of the
basic functionality is included, so readers with no prior knowledge
of **summarytools** can easily follow.

# In the Pipeline 

This section demonstrates how to effectively use **summarytools**
with **magrittr** pipe operators and **dplyr**'s `group_by()`.

## Frequency Tables With freq()

Since version 0.9.0, `freq()` works both with vectors/factors and 
data frames. In the latter case, a list-type object is created, just
like using `lapply(df, freq)` would, with a two key distinctions: 1) the 
resulting object's class is _stby_, which allows **summarytools** to 
immediately seize control over their printing or html rendering; 2) a 
threshold is used to decide whether numerical variables should be 
ignored or not, depending on the number of distinct values they contain.
The value of this threshold has a default value of 25 which can be
modified using `st_options(freq.ignore.threshold)`.

### Frequencies for a Single Vector or Factor

The traditional way:

```{r, eval=FALSE}
freq(tobacco$smoker)
```

The pipes way:
```{r}
tobacco %>% freq(smoker)
# Also possible:
# tobaaco %$% freq(smoker)
```

To obtain grouped statisitics the traditionnal way, we use the `stby()`
function, which works exactly like base R's `by()`:
```{r, eval=FALSE}
stby(data = tobacco$smoker, INDICES = tobacco$gender, FUN = freq)
```

The same can be achieved using `dplyr::group_by`. To avoid a warning about
implicit `NA`'s on the grouping variable, we use `forcats::fct_explicit_na()`
to make them explicit.
```{r}
library(dplyr)
library(forcats)
tobacco %>% 
  group_by(gender = fct_explicit_na(gender)) %>%
  freq(totals = FALSE)
```

The `totals = FALSE` argument was added since it is in the spirit of tidy
data.

#### Using parameters to refine results
Here is an example that illustrates the use of parameters; we want the simplest
table showing the 5 most common values for the "disease" variable:
```{r, eval=FALSE}
freq(tobacco$disease, order = "freq", rows = 1:5, 
     report.nas = FALSE, cumul = FALSE)
```

... the same using pipes:
```{r}
tobacco %>% freq(disease, order = "freq", rows = 1:5, 
                 report.nas = FALSE, cumul = FALSE)
```

### Get Really Tidy
The recently introduced function `tb()` takes summarytools objects and turns
them into _real_ tidy tables. The letters "tb" refer to the word / function
_tibble_. It works with `freq()` and `descr()` only, because the structure of
`ctable()` and `dfSummary()` is not compatible with the concept of tidy data.

Here is what a tidied `freq()` table looks like:
```{r}
tobacco %>% freq(smoker) %>% tbl()
```

When one or more grouping variables are added, we have the following results:
```{r}
tobacco$gender %<>% forcats::fct_explicit_na()
tobacco$age.gr %<>% forcats::fct_explicit_na()
tobacco %>% group_by(gender, age.gr) %>% freq(smoker) %>% tbl()
```


Following the same logic as in previous documents I've written about 
**summarytools**, I'll go over the four core functions (`freq()`,
`descr()`, `ctable()` and `dfSummary()`), and then cover topics 
that apply to all or most of them.

## Frequency Tables: freq()



## Stay Up-to-date

Check out the [GitHub project's page](https://github.com/dcomtois/summarytools) - 
from there you can see the latest updates and also submit feature requests.

For a preview of what's coming in the next release, have a look at the 
[development branch](https://github.com/dcomtois/summarytools/tree/dev-current).

## Final notes

The package comes with no guarantees. It is a work in progress and
feedback / feature requests are welcome. Just send an email to
dominic.comtois@gmail.com, or open an
[Issue on GitHub](https://github.com/dcomtois/summarytools/issues) if you find a
bug or wish to submit a feature request.
