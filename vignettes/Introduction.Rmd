---
title: "Introduction to summarytools"
author: "Dominic Comtois"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette: 
    css: 
    - !expr system.file("rmarkdown/templates/html_vignette/resources/vignette.css", package = "rmarkdown")
vignette: >
  %\VignetteIndexEntry{Introduction to summarytools 0.8}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r knitr-setup, include=FALSE}
library(knitr)
opts_chunk$set(comment = NA, prompt = FALSE, cache = FALSE, results = 'asis')
```

```{r st-setup, results='asis', echo=FALSE}
library(summarytools)
st_options(footnote = NA, subtitle.emphasis = FALSE,
           dfSummary.silent = TRUE, descr.silent = TRUE)
st_css()
```

**summarytools** provides tools to *neatly and quickly summarize data*.  It 
can also make _R_ a little easier to learn and to use, especially for data
cleaning and preliminary analysis. Four functions are at the heart of the
package:

  - `freq()` : **frequency tables** with proportions, cumulative
    proportions and missing data information
  - `ctable()` : **cross-tabulations** between two factors or any
    discrete data, with total, rows or columns proportions, as well
    as marginal totals
  - `descr()` : **descriptive (univariate) statistics** for numerical data
  - `dfSummary()` : Extensive **data frame summaries** that facilitate
    data cleaning and firsthand evaluation

An emphasis has been put on both _what_ and _how_ results are presented, so that
the package can serve both as an exploration _and_ reporting tool, used on its 
own for minimal reports, or with other sets of tools such as 
[rmarkdown](http://rmarkdown.rstudio.com/), and [knitr](https://yihui.name/knitr/).

**Building on the strengths of [pander](https://github.com/Rapporter/pander) and
[htmltools](https://CRAN.R-project.org/package=htmltools)**, the 
outputs produced by **summarytools** can be:

  - Displayed in plain text in the *R* console (default behaviour)
  - Used in *Rmarkdown* documents and *knitted* along with other text and
    *R* output
  - Written to _html_ files that fire up in
    [*RStudio*](http://www.rstudio.com/)’s Viewer pane or in your default
    browser
  - Written to plain or *Rmarkdown* text files

Some users have requested Excel or _csv_ exportation capabilities; these will
surely show up in an upcoming release.

It is also possible to include **summarytools**' functions in *Shiny apps*. 
Notably, [radiant](https://cran.r-project.org/web/packages/radiant/index.html),
a Shiny-based package for business analytics, uses `dfSummary()` to describe
imported data frames.

### Latest Improvements

Versions 0.8.9 (which was only released on GitHub) and 0.9.0 brought _many_
changes and improvements to **summarytools**. This 
[vignette](https://cran.r-project.org/web/packages/summarytools/vignettes/New-in-Version-0-9.html) 
gives a detailed description of all the changes, but a summary can also be found 
[at the end of this document](#changes).

Let's now look at the package's four main functions.

## The Four Core Functions

## 1 - freq() : Frequency Tables

The `freq()` function generates a table of frequencies with counts and
proportions. Since this vignette was created using _Rmarkdown_, we've set the
`style` argument to “rmarkdown”; **knitr** takes care of
converting the generated markup characters into actual formatting.

```{r}
library(summarytools)
freq(iris$Species, style = "rmarkdown")
```

If we do not worry about missing data, we can set `report.nas = FALSE`:

```{r}
freq(iris$Species, report.nas = FALSE, style = "rmarkdown", headings = FALSE)
```

We can simplify the results further and omit the _Totals_ row by specifying 
`totals = FALSE`.

To get familiar with the output styles, try different values for `style` and see
how this affects the results in _R_'s console. 

## 2 - ctable() : Cross-Tabulations

We’ll now use a sample data frame called *tobacco*, which is included in 
**summarytools**. We want to cross-tabulate two categorical variables:
`smoker` and `diseased`. By default, `ctable()` shows row proportions.

Since *markdown* does not support multiline headings, we’ll show a 
rendered _html_ version of the results:

```{r, results = "asis"}
print(ctable(tobacco$smoker, tobacco$diseased), method = "render")
```

Note that we have to set the **knitr** chunk option `results` to “asis”
for the results to appear as they should.

It is possible to display *column*, *total*, or no proportions at all, like in
the next example. We will also omit the marginal totals to have a simple “2 x 2”
table.

```{r, results = "markup"}
with(tobacco, 
     print(ctable(smoker, diseased, prop = 'n', totals = FALSE),
           headings = FALSE, method = "render"))
```

To show column or total proportions, use `prop = "c"` or `prop = "t"`,
respectively.

## 3 - descr() : Descriptive Univariate Stats 

The `descr()` function generates common central tendency statistics and
measures of dispersion for numerical data. It can handle single vectors
as well as data frames, in which case it just ignores non-numerical
columns (and displays a message to that effect).

```{r}
descr(iris, style = "rmarkdown")
```

### Transposing and selecting only the stats you need

If your eyes/brain prefer seeing things the other way around, just use
`transpose = TRUE`. Here, we also select only the statistics we wish to
see, and specify `headings = FALSE` to avoid reprinting the same
information as above.

You can specify the stats you wish to report with the `stats` argument, which
also accepts special values `all`, `fivenum`, and  `common`. See `?descr` for 
The full list of available statistics.

```{r}
descr(iris, stats = "common", transpose = TRUE, 
      headings = FALSE, style = "rmarkdown")
```

## 4 - dfSummary() : Data Frame Summaries

`dfSummary()` collects information about all variables in a data frame and
displays it in a singe, legible table.

To generate a summary report and have it displayed in
[*RStudio*](http://www.rstudio.com/)’s Viewer pane (or in your default
Web Browser if working with another interface), we simply do like this:

```{r, eval=FALSE}
library(summarytools)
view(dfSummary(iris))
```

The results show up in RStudio’s viewer, or in the default Web Browser when not
using RStudio:
<img src="dfSummary_in_RStudio_Viewer.png" width=100% style="border:0" />
It is also possible to use `dfSummary()` in *Rmarkdown* documents. Further down, 
we'll see how to use _html_ rendering to display graphics in their image form 
instead of their ascii replacements.

```{r}
dfSummary(tobacco, plain.ascii = FALSE, style = "grid", 
          graph.magnif = 0.72, valid.col = FALSE)
```

## The print() and view() Functions

**summarytools** has a generic `print` method, `print.summarytools()`. By
default, its `method` argument is set to “pander”. One of the ways in
which `view()` is useful is that we can use it to easily display _html_
outputs in *RStudio*’s Viewer. In this case, the `view()` function
simply acts as a wrapper around the `print()` method, specifying
the `method = 'viewer'` for us. When used outside *RStudio*,
the `method` falls back on “browser” and the report is fired up in the
system’s default browser.

## Using by() to Ventilate Results

You can use *R*’s base function `by()` will all main functions. It returns a 
list-type object having class “by” containing as many elements as there are 
categories in the grouping variable. 

Using the _iris_ data frame, we will display descriptive statistics
broken down by Species.

```{r}
# First save the results
iris_stats_by_species <- by(data = iris, 
                            INDICES = iris$Species, 
                            FUN = descr, stats = c("mean", "sd", "min", "med", "max"), 
                            transpose = TRUE)

# Then we can either use `view()` or print()` to visualize the results:
print(iris_stats_by_species, style = "rmarkdown")
```

To see an _html_ version of these results, we'd simply use `view()` (also
possible is to use `print()` with the argument `method = "viewer"`):

```{r, eval=FALSE}
view(iris_stats_by_species)
# or
print(iris_stats_by_species, method = "viewer")
```

A special situation occurs when we want grouped statistics 
_for one variable only_ using `descr()`. Instead of showing several tables 
having only one column (or row if we use transposition) each, **summarytools** 
will assemble everything into a single table:

```{r}
data(tobacco) # tobacco is an example dataframe included in the package
BMI_by_age <- with(tobacco, 
                   by(BMI, age.gr, descr, 
                      stats = c("mean", "sd", "min", "med", "max")))
print(BMI_by_age, style = "rmarkdown")
```

The transposed version looks like this:

```{r}
BMI_by_age <- with(tobacco, 
                   by(BMI, age.gr, descr,  transpose = TRUE,
                      stats = c("mean", "sd", "min", "med", "max")))
print(BMI_by_age, style = "rmarkdown", headings = FALSE)
```

**Using `by()` with `ctable()`**

The syntax to use is the following:

```{r, eval=FALSE}
by(list(x = tobacco$smoker, y = tobacco$diseased), tobacco$gender, ctable)
# or equivalently
with(tobacco, by(list(x = smoker, y = diseased), gender, ctable))

```


## Generating Several Frequency Tables at Once

There are two ways to do that. The one I recommend is passing the data frame
object (subsetted if needed) directly to `freq()`:

```{r, eval=FALSE}
freq(tobacco[ ,c("gender", "age.gr", "smoker")])
```

As a side note, another way to do it would be using `lapply()`, but it has the 
disadvantage of creating a basic _list_, as opposed to a _summarytools list_. 
The consequence of this is that when you print it just by typing the returned 
object's name (or if you don't affect the results to a variable), the output 
produced in the console will not be optimal. You can however explicitly call `
print()` to get proper results.

## Using summarytools in Rmarkdown documents

As we have seen, **summarytools** can generate both text/_markdown_ and _html_
results. Both types of outputs can be used in Rmarkdown documents. The vignette
[Recommendations for Using summarytools With Rmarkdown](https://cran.r-project.org/web/packages/summarytools/vignettes/Recommendations-rmarkdown.html)
provides good guidelines, but here are a few tips to get started:

 - Always set the `knitr` chunk option `results = 'asis'`. You can do
   this on a chunk-by-chunk basis, but it is easier to do it globally:

```{r, eval=FALSE, tidy=FALSE}
    knitr::opts_chunk$set(echo = TRUE, results = 'asis')
```

\ \ \ \ \ \ \ \ \ \ Refer to [this page](https://yihui.name/knitr/options/) for
more on _knitr_'s options.

  - To get better results when generating _html_ output with `method = 'render'`,
    set up your .Rmd document so it includes **summarytools**’ css. The 
    `st_css()` function makes this very easy.

#### Example

````
# ---
# title: "RMarkdown using summarytools"
# output: html_document
# ---
#
# ```{r, echo=FALSE}
# library(summarytools)
# st_css()
# ```
#
# ```{r, results='asis'}
# print(dfSummary(tobacco, style = 'grid', plain.ascii = FALSE, graph.magnif = 0.82), 
#       method = 'render', headings = FALSE, varnumbers=FALSE, valid.col = FALSE)
# ```
````

## Writing Output to Files

When using `view()` to generate _html_ to be viewed immediately, a message in the 
console reveals the location of the temporary _html_ file that is created (and will
be deleted when the R session is over). However, we can use the `file` argument of
the `print()` or `view()` functions to specify where we want to save the results,
if we wish to reuse or share them:

```{r, eval=FALSE}
view(iris_stats_by_species, file = "~/iris_stats_by_species.html")
```

If the extension is _.html_ or _.md_, **summarytools** will automatically set the
appropriate (and optimal) methods and styles:

```{r, eval = FALSE}
print(dfSummary(tobacco), file = "~/dfSummary_tobacco.html")
# Switching to 'viewer' method, as 'pander' is incompatible with _html_ output file format
# Output file written: ~/dfSummary_tobacco.html

print(dfSummary(tobacco), file = "~/dfSummary_tobacco.md")
# Setting 'plain.ascii' to FALSE and Changing style to 'grid' for improved markdown compatibility
# Output file written: ~/dfSummary_tobacco.md
```

If you don't agree with **summarytools**' “intervention”, you can always override the `style` and
`method` by passing them as arguments to `print()`.

### Appending Output Files

There is also an `append` logical argument for adding content to
existing reports, both text/Rmarkdown and html. This is useful if you want to
quickly include several statistical tables in a single file. It is a quick 
alternative to creating an _.Rmd_ document if you don't need the extra
content that the latter allows to add.

## Global options

The following options can be set with `st_options()`:

**General options** 

| Option name               | Default   | Note                                         |
| ------------------------: | --------: | :------------------------------------------- |
| style                     | “simple”  | Set to “rmarkdown” when necessary            |
| plain.ascii               |    TRUE   | Set to FALSE when doing rmarkdown            |
| round.digits              |       2   | Number of decimals to show                   |
| headings (*)              |    TRUE   | Formerly “omit.headings”                     |
| footnote                  | “default” | Personalize, or set to NA to omit            |
| display.labels            |    TRUE   | Show variable / data frame labels in heading |
| bootstrap.css (*)         |    TRUE   | Include Bootstrap 4 css in _html_            |
| custom.css                |      NA   | Path to your own css file                    |
| escape.pipe               |   FALSE   | Useful with some Pandoc conversions          |
| subtitle.emphasis         |    TRUE   | Controls subtitle formatting                 |
| lang                      |   “en”    | Language (always 2-letter, lowercase)        |

  (*) In rmarkdown or in Shiny apps, better set to FALSE

**Function-specific options**

| Option name            |  Default | Note                                     |
| ---------------------: | -------: | :--------------------------------------- |
| freq.totals            |   TRUE   | Display totals row in freq()             |
| freq.report.nas        |   TRUE   | Display <NA> row and “valid” columns     |
| ctable.prop            |    “r”   | Display **r**ow proportions by default   |
| ctable.totals          |   TRUE   | Show marginal totals                     |
| descr.stats            |   “all”  | “fivenum”, “common” or list of stats     |
| descr.transpose        |  FALSE   |                                          |
| descr.silent           |  FALSE   | Hide messages about ignored variables    |
| dfSummary.varnumbers   |   TRUE   | Show variable numbers in 1st col.        |
| dfSummary.labels.col   |   TRUE   | Show variable labels when present        |
| dfSummary.graph.col    |   TRUE   | Show graphs                              |
| dfSummary.valid.col    |   TRUE   | Include the Valid column in the output   |
| dfSummary.na.col       |   TRUE   | Include the NA column in the output      |
| dfSummary.graph.magnif |      1   | Zoom factor for bar plots and histograms |
| dfSummary.silent       |  FALSE   | Hide messages about temporary files      |

#### Examples

```{r, eval=FALSE}
st_options()                      # display all global options values
st_options('round.digits')        # display the value of a specific option
st_options(style = 'rmarkdown')   # change one or several options' values
st_options(footnote = NA)         # Turn off the footnote on all outputs.
                                  # This option was used prior to generating
                                  # the present document.
```

## Overriding formatting attributes

When a **summarytools** object is stored, its formatting attributes are
stored within it. However, you can override most of them when using the
`print()` method and the `view()` function.

For a full list of arguments that can be used as overrides, please see
`?print.summarytools`.

#### Example 

```{r}
age_stats <- freq(tobacco$age.gr)  # age_stats contains a regular output for freq 
                                   # including headings, NA counts, and Totals
print(age_stats, style = "rmarkdown", report.nas = FALSE, 
                 totals = FALSE, headings = FALSE)
```

Note that the original attributes which we changed temporarily for printing with
these overrides are still part of the _age\_stats_ object.

## Order of Priority for Options / Parameters

1.  Options overridden explicitly with `print()` or `view()` have
    precedence
2.  options specified as explicit arguments to `freq() / ctable() /
    descr() / dfSummary()` come second
3.  Global options, which can be set with `st_options`, come third

## Customizing looks with CSS

**summarytools** uses *RStudio*’s
[htmltools package](https://CRAN.R-project.org/package=htmltools)
and version 4 of [Bootstrap](https://getbootstrap.com/)’s cascading
stylesheets.

It is possible to include your own _css_ if you wish to customize the
look of the output tables. See the documentation for the package’s
`print()` method for all the details, but here is a quick example.

Say you need to make the font size really really small. For this,
you would create a _.css_ file - let’s call it “custom.css” -
containing a class definition such as the following:

```css
.table-condensed {
  font-size: 8px;
}
```

... and then, to apply it to a **summarytools** object and display it in your
browser:

```{r, eval=FALSE}
view(dfSummary(tobacco), custom.css = 'path/to/custom.css', 
     table.classes = 'table-condensed')
```

To display a smaller table that is not **that** small, you can use the
provided css class `st-small`.

## Working with _shiny_ apps

To include **summarytools** functions into **shiny** apps, it is recommended that 
you:

 - set `bootstrap.css = FASE` to avoid interacting with the app's layout  
 - omit headings by setting `headings = FALSE` in the call to `print()` or 
   `view()`
 - adjust the size of the graphs in `dfSummary()` using the `graph.magnif`
   parameter
 - in case of problems with `dfSummary()` outputs, try omitting a column or two
   and setting the column widths with the `col.widths` parameter of the 
   `print()` method
 
```{r, eval=FALSE}
print(dfSummary(somedata, graph.magnif = 0.82), 
      method = 'render',
      headings = FALSE,
      bootstrap.css = FALSE)
```

## Latest Changes and Improvements {#changes}

Versions 0.9.0 and 0.8.9 (which was only released on GitHub) brought many
improvements to **summarytools**. This 
[vignette](https://cran.r-project.org/web/packages/summarytools/vignettes/New-in-Version-0-9.html) 
gives a detailed description of all the changes, but here are the main elements:

 - Translations
   + For now, only a limited number of languages are available (fr, es, ru), but
     as users contribute their own translations, the list will hopefully grow
     much larger
   + To use a different language than English, call the `st_options()` function, 
     like so: `st_options(lang = "fr")
   + An additional function, `useTranslations()` allows using a custom 
     translations _csv_ file; a template is available 
     [here](https://github.com/dcomtois/summarytools/blob/master/translations/language_template.csv)

 - Improved printing of list objects
   + Objects of class “by” are now automatically printed in the console with
     optimal results; no more need for `view(x, method = "pander")
   + Regular lists containing **summarytools** objects can also be printed with
     optimal results simply by calling `print(x)` (as opposed to “by” objects,
     their automatic printing will **not** be optimal; that being said, `freq()`
     now accepts data frames as its first argument, so the need for `lapply()`
     is greatly diminished)

 - Easier management of global settings with `st_options()` 
   +  The `st_options()` function now has as many parameters as there are 
      options to set, making it possible to set all options (if ever that is
      necessary) with only one function call
   + The legacy way of setting options is still supported

 - Changes to `dfSummary()`
   + Number of columns in now included in the heading section
   + Number of duplicated rows is also shown in the heading section
   + Bar plots now more accurately reflect counts, as they are not stretched
     across table cells (this allows the comparison of frequencies even across 
     variables)
   + Columns with particular content (unary/binary, integer sequences, UPC/EAN
     codes) are treated differently; more relevant information is displayed,
     while irrelevant information is not
   + For _html_ outputs, a new parameter `col.widths` may be used to set the
     width of the output table's columns, in pixels; this addresses an issue
     with some graphs not shown at the desired magnification level

 - Changes to `descr()`
   + For the `stats` argument, Values “fivenum” and “common” are now allowed,
     the latter representing the collection of _mean_, _sd_, _min_, _med_,
     _max_, _n.valid_, and _pct.valid_
  + Improved outputs when using `by()` 
   + The variable used for weights (if any) is removed automatically from the
     dataset so no stats will be produced for it

 - Changes to `freq()`
   + As mentioned earlier, the function now accepts data frames as main 
     argument; this makes obsolete the use of `lapply()` with it
  + Improved outputs when using `by()`
  
 - Changes to `ctable()`
   + Now fully supports `by()`

** Other notable changes **
 - The `omit.headings` parameter has been replaced by the more straightforward
   `headings`. `omit.heandings` is still supported in this version but will be
   deprecated in some future version
 - Because it was subject to errors, the _Rows Subset_ heading element
   has been removed. If there is a strong need for it, I can bring it back in a 
   future release (just let me known by email or on GitHub if this is what you 
   think)
 - Under the hood, much has been going on; the lengthier functions have been
   split into more manageable parts, and several normalizing operations were
   done, facilitating maintenance and improving code readability

## Stay Up-to-date

Check out the [GitHub project's page](https://github.com/dcomtois/summarytools) - 
from there you can see the latest updates and also submit feature requests.

For a preview of what's coming in the next release, see the 
[development branch](https://github.com/dcomtois/summarytools/tree/dev-current).

# Final notes

The package comes with no guarantees. It is a work in progress and
feedback / feature requests are welcome. Just send me an email
(dominic.comtois@gmail.com), or open an
[Issue on GitHub](https://github.com/dcomtois/summarytools/issues) if you find a
bug or want to submit a feature request.
