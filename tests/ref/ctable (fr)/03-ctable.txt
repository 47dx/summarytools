
# -------------------------- 3-ctable.R ----------------------------------------  

> data(tobacco) 
> tobacco <- tibble::as.tibble(tobacco) 
> ctable(tobacco$smoker, tobacco$diseased, caption = "test encod: éêàáûï") 

Tableau croisé, proportions par rangées   
smoker * diseased     
Data frame: tobacco   

-------- ---------- -------------- -------------- ----------------
           diseased            Yes             No            Total
  smoker                                                          
     Yes              125 (41.95%)   173 (58.05%)    298 (100.00%)
      No               99 (14.10%)   603 (85.90%)    702 (100.00%)
   Total              224 (22.40%)   776 (77.60%)   1000 (100.00%)
-------- ---------- -------------- -------------- ----------------

Table: test encod: éêàáûï

> label(tobacco) <- "A Study on Tobacco Use and Health" 

# always show NAs -------------------------------------------------------------- 

> (ct1 <- ctable(tobacco$smoker, tobacco$diseased, useNA = 'always')) 

Tableau croisé, proportions par rangées   
smoker * diseased     
Data frame: tobacco    
Étiquette: A Study on Tobacco Use and Health   

-------- ---------- -------------- -------------- ----------- ----------------
           diseased            Yes             No        <NA>            Total
  smoker                                                                      
     Yes              125 (41.95%)   173 (58.05%)   0 (0.00%)    298 (100.00%)
      No               99 (14.10%)   603 (85.90%)   0 (0.00%)    702 (100.00%)
    <NA>                0 ( 0.00%)     0 ( 0.00%)   0 (0.00%)      0 (  0.00%)
   Total              224 (22.40%)   776 (77.60%)   0 (0.00%)   1000 (100.00%)
-------- ---------- -------------- -------------- ----------- ----------------

> st_options(display.labels = F) 
> print(ct1, file = "ctable-ct1-1.html") 
-- Switching method to 'browser'
-- Output file written

> print(ct1, totals=FALSE, file = "ctable-ct1-no-totals-print.md", style = "grid", plain.ascii = FALSE) 
-- Output file written

> view(ct1, totals=FALSE, file = "ctable-ct1-no-totals-view.md", style = "grid", plain.ascii = FALSE) 
-- Switching method to 'pander'
-- Output file written


# Non-default proportions ------------------------------------------------------ 

> ctable(tobacco$smoker, tobacco$diseased, useNA = 'no', prop = 'c') 

Tableau croisé, proportions par colonnes   
smoker * diseased     
Data frame: tobacco   

-------- ---------- --------------- --------------- ----------------
           diseased             Yes              No            Total
  smoker                                                            
     Yes              125 ( 55.80%)   173 ( 22.29%)    298 ( 29.80%)
      No               99 ( 44.20%)   603 ( 77.71%)    702 ( 70.20%)
   Total              224 (100.00%)   776 (100.00%)   1000 (100.00%)
-------- ---------- --------------- --------------- ----------------

> ctable(tobacco$smoker, tobacco$diseased, prop = 'n') 

Tableau croisé   
smoker * diseased     
Data frame: tobacco   

-------- ---------- ----- ----- -------
           diseased   Yes    No   Total
  smoker                               
     Yes              125   173     298
      No               99   603     702
   Total              224   776    1000
-------- ---------- ----- ----- -------

> ctable(tobacco$smoker, tobacco$diseased, prop = 't') 

Tableau croisé, proportions sur le total   
smoker * diseased     
Data frame: tobacco   

-------- ---------- -------------- -------------- ----------------
           diseased            Yes             No            Total
  smoker                                                          
     Yes              125 (12.50%)   173 (17.30%)    298 ( 29.80%)
      No               99 ( 9.90%)   603 (60.30%)    702 ( 70.20%)
   Total              224 (22.40%)   776 (77.60%)   1000 (100.00%)
-------- ---------- -------------- -------------- ----------------


# Calculated y variable -------------------------------------------------------- 

> data(exams) 
> ctable(exams$gender, exams$french < 60) 
-- Variable name 'french < 60' was guessed but could not be confirmed

Tableau croisé, proportions par rangées   
gender * french < 60     
Data frame: exams   

-------- ------------- -------------- ----------- ----------- --------------
           french < 60          FALSE        TRUE        <NA>          Total
  gender                                                                    
    Girl                 13 ( 86.67%)   1 (6.67%)   1 (6.67%)   15 (100.00%)
     Boy                 15 (100.00%)   0 (0.00%)   0 (0.00%)   15 (100.00%)
   Total                 28 ( 93.33%)   1 (3.33%)   1 (3.33%)   30 (100.00%)
-------- ------------- -------------- ----------- ----------- --------------

> ctable(exams$gender, exams$french < 60, dnn = c("Gender", "Failed French Class"), caption = "dnn in use") 

Tableau croisé, proportions par rangées   
Gender * Failed French Class     
Data frame: exams   

-------- --------------------- -------------- ----------- ----------- --------------
           Failed French Class          FALSE        TRUE        <NA>          Total
  Gender                                                                            
    Girl                         13 ( 86.67%)   1 (6.67%)   1 (6.67%)   15 (100.00%)
     Boy                         15 (100.00%)   0 (0.00%)   0 (0.00%)   15 (100.00%)
   Total                         28 ( 93.33%)   1 (3.33%)   1 (3.33%)   30 (100.00%)
-------- --------------------- -------------- ----------- ----------- --------------

Table: dnn in use


# Subsetting ------------------------------------------------------------------- 

> ctable(tobacco$smoker[1:250], tobacco$diseased[1:250], headings = FALSE) 


-------- ---------- ------------- -------------- ---------------
           diseased           Yes             No           Total
  smoker                                                        
     Yes              31 (45.59%)    37 (54.41%)    68 (100.00%)
      No              36 (19.78%)   146 (80.22%)   182 (100.00%)
   Total              67 (26.80%)   183 (73.20%)   250 (100.00%)
-------- ---------- ------------- -------------- ---------------

> ctable(tobacco[[1]], tobacco[,3]) 

Tableau croisé, proportions par rangées   
gender * age.gr     
Data frame: tobacco   

-------- -------- -------------- -------------- -------------- -------------- ------------ ----------------
           age.gr          18-34          35-50          51-70           71 +         <NA>            Total
  gender                                                                                                   
       F            123 (25.15%)   118 (24.13%)   157 (32.11%)    77 (15.75%)   14 (2.86%)    489 (100.00%)
       M            130 (26.58%)   118 (24.13%)   151 (30.88%)    79 (16.16%)   11 (2.25%)    489 (100.00%)
    <NA>              5 (22.73%)     5 (22.73%)     9 (40.91%)     3 (13.64%)    0 (0.00%)     22 (100.00%)
   Total            258 (25.80%)   241 (24.10%)   317 (31.70%)   159 (15.90%)   25 (2.50%)   1000 (100.00%)
-------- -------- -------------- -------------- -------------- -------------- ------------ ----------------


# with() ----------------------------------------------------------------------- 

> with(tobacco, ctable(smoker,  diseased)) 

Tableau croisé, proportions par rangées   
smoker * diseased    

-------- ---------- -------------- -------------- ----------------
           diseased            Yes             No            Total
  smoker                                                          
     Yes              125 (41.95%)   173 (58.05%)    298 (100.00%)
      No               99 (14.10%)   603 (85.90%)    702 (100.00%)
   Total              224 (22.40%)   776 (77.60%)   1000 (100.00%)
-------- ---------- -------------- -------------- ----------------


# by()  ------------------------------------------------------------------------ 

> by(list(x = tobacco$smoker, y = tobacco$diseased), tobacco$gender, ctable) 

Tableau croisé, proportions par rangées   
smoker * diseased     
Data frame: tobacco    
Groupe: gender = F   

-------- ---------- -------------- -------------- ---------------
           diseased            Yes             No           Total
  smoker                                                         
     Yes               62 (42.18%)    85 (57.82%)   147 (100.00%)
      No               49 (14.33%)   293 (85.67%)   342 (100.00%)
   Total              111 (22.70%)   378 (77.30%)   489 (100.00%)
-------- ---------- -------------- -------------- ---------------
  
Groupe: gender = M   

-------- ---------- -------------- -------------- ---------------
           diseased            Yes             No           Total
  smoker                                                         
     Yes               63 (44.06%)    80 (55.94%)   143 (100.00%)
      No               47 (13.58%)   299 (86.42%)   346 (100.00%)
   Total              110 (22.49%)   379 (77.51%)   489 (100.00%)
-------- ---------- -------------- -------------- ---------------

# with() + by() ---------------------------------------------------------------- 

> with(tobacco, by(list(x = smoker, y = diseased), gender, ctable)) # problématique! 

Tableau croisé, proportions par rangées   
smoker * diseased     
Groupe: gender = F   

-------- ---------- -------------- -------------- ---------------
           diseased            Yes             No           Total
  smoker                                                         
     Yes               62 (42.18%)    85 (57.82%)   147 (100.00%)
      No               49 (14.33%)   293 (85.67%)   342 (100.00%)
   Total              111 (22.70%)   378 (77.30%)   489 (100.00%)
-------- ---------- -------------- -------------- ---------------
  
Groupe: gender = M   

-------- ---------- -------------- -------------- ---------------
           diseased            Yes             No           Total
  smoker                                                         
     Yes               63 (44.06%)    80 (55.94%)   143 (100.00%)
      No               47 (13.58%)   299 (86.42%)   346 (100.00%)
   Total              110 (22.49%)   379 (77.51%)   489 (100.00%)
-------- ---------- -------------- -------------- ---------------

> wbc <- with(tobacco, by(list(x = smoker, y = diseased), gender, ctable, headings = F)) 
> print(wbc, headings = T) 

Tableau croisé, proportions par rangées   
smoker * diseased     
Groupe: gender = F   

-------- ---------- -------------- -------------- ---------------
           diseased            Yes             No           Total
  smoker                                                         
     Yes               62 (42.18%)    85 (57.82%)   147 (100.00%)
      No               49 (14.33%)   293 (85.67%)   342 (100.00%)
   Total              111 (22.70%)   378 (77.30%)   489 (100.00%)
-------- ---------- -------------- -------------- ---------------
  
Groupe: gender = M   

-------- ---------- -------------- -------------- ---------------
           diseased            Yes             No           Total
  smoker                                                         
     Yes               63 (44.06%)    80 (55.94%)   143 (100.00%)
      No               47 (13.58%)   299 (86.42%)   346 (100.00%)
   Total              110 (22.49%)   379 (77.51%)   489 (100.00%)
-------- ---------- -------------- -------------- ---------------

> print(wbc, headings = T, file = "ctable-wbc-print.md") 
-- Setting 'plain.ascii' to FALSE and Changing style to 'grid' for improved markdown compatibility
-- Output file written
-- Setting 'plain.ascii' to FALSE and Changing style to 'grid' for improved markdown compatibility
-- Output file appended

> print(wbc, headings = T, file = "ctable-wbc-print.html") 
-- Switching method to 'browser'
-- Output file written
-- Output file appended

> view(wbc, headings = T, file = "ctable-wbc-view-with-head.md") 
-- Switching method to 'pander'
-- Setting 'plain.ascii' to FALSE and Changing style to 'grid' for improved markdown compatibility
-- Output file written
-- Setting 'plain.ascii' to FALSE and Changing style to 'grid' for improved markdown compatibility
-- Output file appended

> view(wbc, headings = T, file = "ctable-wbc-view-with-head.html") 
-- Output file written
-- Output file appended
