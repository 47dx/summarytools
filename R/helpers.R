# Fn to smartly split variable names that are too long
# ref: https://tinyurl.com/y7qv48z9
#' @keywords internal
smart_split <- function(str, maxlen) {
  re <- paste0("(?=.{1,", maxlen, "}(.*))",
               "(?=.*?[^\\W._].*?[\\W._].*?\\1)",
               ".{1,", maxlen, "}(?<=_|\\b|\\Z)",
               "|.{1,", maxlen, "}")
  matchinfo <- gregexpr(pattern = re,
                        text = str, perl = TRUE)
  groups <- regmatches(x = str, m = matchinfo)[[1]]
  paste(groups, collapse = "<br/>")
}

# infix to simplify append()ing 
#' @keywords internal
`%+=%` <- function(x, y) {
  assign(x = deparse(substitute(x)), value = append(x, y), 
         envir = parent.frame())
}

# Remove quotation marks inside a string
#' @keywords internal
unquote <- function(x) {
  x <- sub("^\\'(.+)\\'$", '\\1', x)
  x <- sub('^\\"(.+)\\"$', '\\1', x)
  x
}

# Replace accentuated characters by their html numerical code
#' @keywords internal
repl_accents <- function(...) {
  replacements <-
    list(
      c('\u00A1', '&#161;'),  # ¡
      c('\u00A2', '&#162;'),  # ¢
      c('\u00A3', '&#163;'),  # £
      c('\u00A4', '&#164;'),  # ¤
      c('\u00A5', '&#165;'),  # ¥
      c('\u00A7', '&#167;'),  # §
      c('\u00A9', '&#169;'),  # ©
      c('\u00AA', '&#170;'),  # ª
      c('\u00AB', '&#171;'),  # «
      c('\u00AC', '&#172;'),  # ¬
      c('\u00AE', '&#174;'),  # ®
      c('\u00AF', '&#175;'),  # ¯
      c('\u00B0', '&#176;'),  # °
      c('\u00B1', '&#177;'),  # ±
      c('\u00B2', '&#178;'),  # ²
      c('\u00B3', '&#179;'),  # ³
      c('\u00B4', '&#180;'),  # ´
      c('\u00B5', '&#181;'),  # µ
      c('\u00B7', '&#183;'),  # ·
      c('\u00B8', '&#184;'),  # ¸
      c('\u00B9', '&#185;'),  # ¹
      c('\u00BA', '&#186;'),  # º
      c('\u00BB', '&#187;'),  # »
      c('\u00BC', '&#188;'),  # ¼
      c('\u00BD', '&#189;'),  # ½
      c('\u00BE', '&#190;'),  # ¾
      c('\u00BF', '&#191;'),  # ¿
      c('\u00C0', '&#192;'),  # À
      c('\u00C1', '&#193;'),  # Á
      c('\u00C2', '&#194;'),  # Â
      c('\u00C3', '&#195;'),  # Ã
      c('\u00C4', '&#196;'),  # Ä
      c('\u00C5', '&#197;'),  # Å
      c('\u00C6', '&#198;'),  # Æ
      c('\u00C7', '&#199;'),  # Ç
      c('\u00C8', '&#200;'),  # È
      c('\u00C9', '&#201;'),  # É
      c('\u00CA', '&#202;'),  # Ê
      c('\u00CB', '&#203;'),  # Ë
      c('\u00CC', '&#204;'),  # Ì
      c('\u00CD', '&#205;'),  # Í
      c('\u00CE', '&#206;'),  # Î
      c('\u00CF', '&#207;'),  # Ï
      c('\u00D0', '&#208;'),  # Ð
      c('\u00D1', '&#209;'),  # Ñ
      c('\u00D2', '&#210;'),  # Ò
      c('\u00D3', '&#211;'),  # Ó
      c('\u00D4', '&#212;'),  # Ô
      c('\u00D5', '&#213;'),  # Õ
      c('\u00D6', '&#214;'),  # Ö
      c('\u00D8', '&#216;'),  # Ø
      c('\u00D9', '&#217;'),  # Ù
      c('\u00DA', '&#218;'),  # Ú
      c('\u00DB', '&#219;'),  # Û
      c('\u00DC', '&#220;'),  # Ü
      c('\u00DD', '&#221;'),  # Ý
      c('\u00DE', '&#222;'),  # Þ
      c('\u00DF', '&#223;'),  # ß
      c('\u00E0', '&#224;'),  # à
      c('\u00E1', '&#225;'),  # á
      c('\u00E2', '&#226;'),  # â
      c('\u00E3', '&#227;'),  # ã
      c('\u00E4', '&#228;'),  # ä
      c('\u00E5', '&#229;'),  # å
      c('\u00E6', '&#230;'),  # æ
      c('\u00E7', '&#231;'),  # ç
      c('\u00E8', '&#232;'),  # è
      c('\u00E9', '&#233;'),  # é
      c('\u00EA', '&#234;'),  # ê
      c('\u00EB', '&#235;'),  # ë
      c('\u00EC', '&#236;'),  # ì
      c('\u00ED', '&#237;'),  # í
      c('\u00EE', '&#238;'),  # î
      c('\u00EF', '&#239;'),  # ï
      c('\u00F0', '&#240;'),  # ð
      c('\u00F1', '&#241;'),  # ñ
      c('\u00F2', '&#242;'),  # ò
      c('\u00F3', '&#243;'),  # ó
      c('\u00F4', '&#244;'),  # ô
      c('\u00F5', '&#245;'),  # õ
      c('\u00F6', '&#246;'),  # ö
      c('\u00F8', '&#248;'),  # ø
      c('\u00F9', '&#249;'),  # ù
      c('\u00FA', '&#250;'),  # ú
      c('\u00FB', '&#251;'),  # û
      c('\u00FC', '&#252;'),  # ü
      c('\u00FD', '&#253;'),  # ý
      c('\u00FE', '&#254;'),  # þ
      c('\u00FF', '&#255;'),  # ÿ
      c('\u0100', '&#256;'),  # Ā
      c('\u0101', '&#257;'),  # ā
      c('\u0102', '&#258;'),  # Ă
      c('\u0103', '&#259;'),  # ă
      c('\u0104', '&#260;'),  # Ą
      c('\u0105', '&#261;'),  # ą
      c('\u0106', '&#262;'),  # Ć
      c('\u0107', '&#263;'),  # ć
      c('\u0108', '&#264;'),  # Ĉ
      c('\u0109', '&#265;'),  # ĉ
      c('\u010A', '&#266;'),  # Ċ
      c('\u010B', '&#267;'),  # ċ
      c('\u010C', '&#268;'),  # Č
      c('\u010D', '&#269;'),  # č
      c('\u010E', '&#270;'),  # Ď
      c('\u010F', '&#271;'),  # ď
      c('\u0110', '&#272;'),  # Đ
      c('\u0111', '&#273;'),  # đ
      c('\u0112', '&#274;'),  # Ē
      c('\u0113', '&#275;'),  # ē
      c('\u0114', '&#276;'),  # Ĕ
      c('\u0115', '&#277;'),  # ĕ
      c('\u0116', '&#278;'),  # Ė
      c('\u0117', '&#279;'),  # ė
      c('\u0118', '&#280;'),  # Ę
      c('\u0119', '&#281;'),  # ę
      c('\u011A', '&#282;'),  # Ě
      c('\u011B', '&#283;'),  # ě
      c('\u011C', '&#284;'),  # Ĝ
      c('\u011D', '&#285;'),  # ĝ
      c('\u011E', '&#286;'),  # Ğ
      c('\u011F', '&#287;'),  # ğ
      c('\u0120', '&#288;'),  # Ġ
      c('\u0121', '&#289;'),  # ġ
      c('\u0122', '&#290;'),  # Ģ
      c('\u0123', '&#291;'),  # ģ
      c('\u0124', '&#292;'),  # Ĥ
      c('\u0125', '&#293;'),  # ĥ
      c('\u0126', '&#294;'),  # Ħ
      c('\u0127', '&#295;'),  # ħ
      c('\u0128', '&#296;'),  # Ĩ
      c('\u0129', '&#297;'),  # ĩ
      c('\u012A', '&#298;'),  # Ī
      c('\u012B', '&#299;'),  # ī
      c('\u012C', '&#300;'),  # Ĭ
      c('\u012D', '&#301;'),  # ĭ
      c('\u012E', '&#302;'),  # Į
      c('\u012F', '&#303;'),  # į
      c('\u0130', '&#304;'),  # İ
      c('\u0131', '&#305;'),  # ı
      c('\u0132', '&#306;'),
      c('\u0133', '&#307;'),
      c('\u0134', '&#308;'),  # Ĵ
      c('\u0135', '&#309;'),  # ĵ
      c('\u0136', '&#310;'),  # Ķ
      c('\u0137', '&#311;'),  # ķ
      c('\u0138', '&#312;'),
      c('\u0139', '&#313;'),  # Ĺ
      c('\u013A', '&#314;'),  # ĺ
      c('\u013B', '&#315;'),  # Ļ
      c('\u013C', '&#316;'),  # ļ
      c('\u013D', '&#317;'),  # Ľ
      c('\u013E', '&#318;'),  # ľ
      c('\u013F', '&#319;'),
      c('\u0140', '&#320;'),
      c('\u0141', '&#321;'),  # Ł
      c('\u0142', '&#322;'),  # ł
      c('\u0143', '&#323;'),  # Ń
      c('\u0144', '&#324;'),  # ń
      c('\u0145', '&#325;'),  # Ņ
      c('\u0146', '&#326;'),  # ņ
      c('\u0147', '&#327;'),  # Ň
      c('\u0148', '&#328;'),  # ň
      c('\u014A', '&#330;'),
      c('\u014B', '&#331;'),
      c('\u014C', '&#332;'),  # Ō
      c('\u014D', '&#333;'),  # ō
      c('\u014E', '&#334;'),  # Ŏ
      c('\u014F', '&#335;'),  # ŏ
      c('\u0150', '&#336;'),  # Ő
      c('\u0151', '&#337;'),  # ő
      c('\u0152', '&#338;'),  # Œ
      c('\u0153', '&#339;'),  # œ
      c('\u0154', '&#340;'),  # Ŕ
      c('\u0155', '&#341;'),  # ŕ
      c('\u0156', '&#342;'),  # Ŗ
      c('\u0157', '&#343;'),  # ŗ
      c('\u0158', '&#344;'),  # Ř
      c('\u0159', '&#345;'),  # ř
      c('\u015A', '&#346;'),  # Ś
      c('\u015B', '&#347;'),  # ś
      c('\u015C', '&#348;'),  # Ŝ
      c('\u015D', '&#349;'),  # ŝ
      c('\u015E', '&#350;'),  # Ş
      c('\u015F', '&#351;'),  # ş
      c('\u0160', '&#352;'),  # Š
      c('\u0161', '&#353;'),  # š
      c('\u0162', '&#354;'),  # Ţ
      c('\u0163', '&#355;'),  # ţ
      c('\u0164', '&#356;'),  # Ť
      c('\u0165', '&#357;'),  # ť
      c('\u0166', '&#358;'),  # Ŧ
      c('\u0167', '&#359;'),  # ŧ
      c('\u0168', '&#360;'),  # Ũ
      c('\u0169', '&#361;'),  # ũ
      c('\u016A', '&#362;'),  # Ū
      c('\u016B', '&#363;'),  # ū
      c('\u016C', '&#364;'),  # Ŭ
      c('\u016D', '&#365;'),  # ŭ
      c('\u016E', '&#366;'),  # Ů
      c('\u016F', '&#367;'),  # ů
      c('\u0170', '&#368;'),  # Ű
      c('\u0171', '&#369;'),  # ű
      c('\u0172', '&#370;'),  # Ų
      c('\u0173', '&#371;'),  # ų
      c('\u0174', '&#372;'),  # Ŵ
      c('\u0175', '&#373;'),  # ŵ
      c('\u0176', '&#374;'),  # Ŷ
      c('\u0177', '&#375;'),  # ŷ
      c('\u0178', '&#376;'),  # Ÿ
      c('\u0179', '&#377;'),  # Ź
      c('\u017A', '&#378;'),  # ź
      c('\u017B', '&#379;'),  # Ż
      c('\u017C', '&#380;'),  # ż
      c('\u017D', '&#381;'),  # Ž
      c('\u017E', '&#382;'),  # ž
      c('\u017F', '&#383;')
    )

  out <- c()
  for (s in list(...)) {
    for(repl in replacements) {
      s <- gsub(repl[1], repl[2], s)
    }
    out %+=% s
  }
  out
}
